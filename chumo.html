<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>China Population Heatmap</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .tooltip {
            position: absolute;
            text-align: center;
            padding: 8px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            border-radius: 4px;
            pointer-events: none;
        }
        .map {
            border: 1px solid #ccc;
        }
    </style>
</head>
<body>
    <h1>China Population Heatmap</h1>
    <svg id="map" class="map" width="800" height="600"></svg>

    <script>
        // 地图 SVG 容器
        const svg = d3.select("#map");
        const width = 800;
        const height = 600;

        // 地图投影
        const projection = d3.geoMercator()
            .center([107, 31]) // 中国地图的中心点
            .scale(700)
            .translate([width / 2, height / 2]);

        const path = d3.geoPath().projection(projection);

        // 人口数据（示例数据）
        const populationData = {
            "Beijing": 2154,
            "Tianjin": 1560,
            "Hebei": 7556,
            "Shanxi": 3718,
            "Inner Mongolia": 2520,
            "Liaoning": 4359,
            "Jilin": 2704,
            "Heilongjiang": 3185,
            "Shanghai": 2487,
            "Jiangsu": 8475,
            "Zhejiang": 6457,
            "Anhui": 6102,
            "Fujian": 4154,
            "Jiangxi": 4648,
            "Shandong": 10047,
            "Henan": 9605,
            "Hubei": 5917,
            "Hunan": 6644,
            "Guangdong": 12601,
            "Guangxi": 5079,
            "Hainan": 1027,
            "Chongqing": 3205,
            "Sichuan": 8367,
            "Guizhou": 3856,
            "Yunnan": 4830,
            "Tibet": 365,
            "Shaanxi": 3864,
            "Gansu": 2637,
            "Qinghai": 603,
            "Ningxia": 720,
            "Xinjiang": 2487
        };

        // 颜色比例尺
        const colorScale = d3.scaleSequential(d3.interpolateReds)
            .domain([0, d3.max(Object.values(populationData))]);

        // 工具提示
        const tooltip = d3.select("body").append("div")
            .attr("class", "tooltip")
            .style("opacity", 0);

        // 加载 GeoJSON 数据
        d3.json("https://raw.githubusercontent.com/echarts-maps/echarts-china-cities-js/master/json/china.json")
            .then(geoData => {
                svg.selectAll("path")
                    .data(geoData.features)
                    .enter()
                    .append("path")
                    .attr("d", path)
                    .attr("fill", d => {
                        const name = d.properties.name;
                        const population = populationData[name];
                        return population ? colorScale(population) : "#ccc";
                    })
                    .attr("stroke", "#fff")
                    .attr("stroke-width", 0.5)
                    .on("mouseover", function(event, d) {
                        const name = d.properties.name;
                        const population = populationData[name] || "No data";
                        tooltip.transition().duration(200).style("opacity", 0.9);
                        tooltip.html(`${name}<br>Population: ${population}万`)
                            .style("left", (event.pageX + 10) + "px")
                            .style("top", (event.pageY - 28) + "px");
                    })
                    .on("mouseout", () => {
                        tooltip.transition().duration(200).style("opacity", 0);
                    });
            })
            .catch(error => console.error("Error loading GeoJSON:", error));
    </script>
</body>
</html>
